<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Projects - ProjectDock</title>
    <meta name="description" content="Browse all your projects in one place">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="nav-logo" id="nav-logo">
                    <svg class="dock-icon" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect class="dock-base" x="2" y="20" width="28" height="10" rx="2" fill="url(#dockGradient)"/>
                        <rect class="project-box box-1" x="6" y="12" width="6" height="6" rx="1" fill="url(#boxGradient1)"/>
                        <rect class="project-box box-2" x="13" y="10" width="6" height="6" rx="1" fill="url(#boxGradient2)"/>
                        <rect class="project-box box-3" x="20" y="14" width="6" height="6" rx="1" fill="url(#boxGradient3)"/>
                        <rect x="4" y="24" width="2" height="6" fill="url(#dockGradient)"/>
                        <rect x="12" y="24" width="2" height="6" fill="url(#dockGradient)"/>
                        <rect x="20" y="24" width="2" height="6" fill="url(#dockGradient)"/>
                        <rect x="26" y="24" width="2" height="6" fill="url(#dockGradient)"/>
                        <defs>
                            <linearGradient id="dockGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="boxGradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="boxGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="boxGradient3" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                    </svg>
                </span>
                <span class="nav-brand-text">ProjectDock</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="projects.html" class="nav-link active">Projects</a></li>
                <li><a href="add-project.html" class="nav-link">Add Project</a></li>
                <li><a href="categories.html" class="nav-link">Categories</a></li>
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>
            <button class="theme-toggle" aria-label="Toggle theme">
                <span>üåô</span>
            </button>
            <button class="hamburger" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Page Header -->
    <section style="background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end)); padding: 8rem 1.5rem 4rem; margin-top: 70px;">
        <div class="container">
            <h1 class="text-center" style="color: white; margin-bottom: 1rem;">All Projects</h1>
            <p class="text-center" style="color: rgba(255,255,255,0.9); max-width: 600px; margin: 0 auto;">Browse and manage all your projects in one place</p>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="container" style="padding: 2rem 1.5rem;">
        <div class="search-container">
            <input type="text" 
                   id="search-input" 
                   class="search-input" 
                   placeholder="Search projects by name, developer, description, or technology...">
            <span class="search-icon">üîç</span>
        </div>

        <div class="filter-container">
            <button class="filter-btn active" data-category="all">All</button>
            <button class="filter-btn" data-category="Web Development">Web Development</button>
            <button class="filter-btn" data-category="Mobile Development">Mobile Development</button>
            <button class="filter-btn" data-category="Design">Design</button>
            <button class="filter-btn" data-category="Data Science">Data Science</button>
            <button class="filter-btn" data-category="Other">Other</button>
        </div>

        <!-- Tags Filter -->
        <div style="margin-top: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500;">Filter by Tags:</label>
            <div id="tags-filter-container" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                <!-- Tags will be loaded dynamically -->
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <div>
                <label for="sort-select" style="margin-right: 0.5rem; color: var(--text-secondary);">Sort by:</label>
                <select id="sort-select" class="form-select" style="padding: 0.5rem 1rem; border-radius: var(--radius-md); border: 2px solid var(--border-color);">
                    <option value="date-newest">Newest First</option>
                    <option value="date-oldest">Oldest First</option>
                    <option value="name-asc">Name (A-Z)</option>
                    <option value="name-desc">Name (Z-A)</option>
                </select>
            </div>
            <div style="color: var(--text-secondary);">
                <span id="project-count">0</span> project(s) found
            </div>
        </div>
    </section>

    <!-- Projects Grid -->
    <section class="container" style="padding: 0 1.5rem 4rem;">
        <div class="grid grid-3" id="projects-grid">
            <!-- Projects will be loaded here -->
        </div>
        <div id="no-projects" class="hidden" style="text-align: center; padding: 4rem 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üìÅ</div>
            <h3 style="margin-bottom: 1rem;">No projects found</h3>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">Try adjusting your search or filters, or create a new project.</p>
            <a href="add-project.html" class="btn btn-primary">Add New Project</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>ProjectDock</h4>
                    <p>Organize, showcase, and track your projects with ease.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="projects.html">Projects</a></li>
                        <li><a href="add-project.html">Add Project</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="categories.html">Categories</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 ProjectDock. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        let allProjects = [];
        let filteredProjects = [];
        let selectedTags = [];

        // Load and display projects
        function loadProjects() {
            allProjects = ProjectDock.ProjectStorage.getProjects();
            if (!Array.isArray(allProjects)) {
                console.error('Projects data is not an array:', allProjects);
                allProjects = [];
            }
            console.log('Loaded projects for projects page:', allProjects.length, allProjects);
            filteredProjects = [...allProjects];
            loadTagsFilter();
            renderProjects();
            updateProjectCount();
        }

        // Load tags for filter
        function loadTagsFilter() {
            const allTags = new Set();
            allProjects.forEach(project => {
                if (project.tags && Array.isArray(project.tags)) {
                    project.tags.forEach(tag => allTags.add(tag.toLowerCase()));
                }
            });
            
            const tagsContainer = document.getElementById('tags-filter-container');
            if (tagsContainer && allTags.size > 0) {
                tagsContainer.innerHTML = Array.from(allTags).sort().map(tag => {
                    return `<button class="tag-filter-btn" data-tag="${tag}" style="padding: 0.4rem 0.8rem; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition-base); font-size: 0.875rem; color: var(--text-primary);">#${tag}</button>`;
                }).join('');
                
                // Add click handlers
                tagsContainer.querySelectorAll('.tag-filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        btn.classList.toggle('active');
                        const tag = btn.dataset.tag;
                        if (btn.classList.contains('active')) {
                            if (!selectedTags.includes(tag)) {
                                selectedTags.push(tag);
                            }
                        } else {
                            selectedTags = selectedTags.filter(t => t !== tag);
                        }
                        filterProjects();
                    });
                });
            } else if (tagsContainer) {
                tagsContainer.innerHTML = '<p style="color: var(--text-light); font-size: 0.875rem;">No tags available</p>';
            }
        }

        // Render projects to grid
        function renderProjects() {
            const grid = document.getElementById('projects-grid');
            const noProjects = document.getElementById('no-projects');

            if (filteredProjects.length === 0) {
                grid.innerHTML = '';
                noProjects.classList.remove('hidden');
                return;
            }

            noProjects.classList.add('hidden');
            
            console.log('Rendering', filteredProjects.length, 'projects to grid');
            
            // Create project cards using DOM methods to avoid HTML injection issues
            grid.innerHTML = ''; // Clear first
            
            filteredProjects.forEach((project, index) => {
                // Check if thumbnail exists and is valid
                let thumbnailSrc = `https://via.placeholder.com/400x200?text=${encodeURIComponent(project.name || 'Project')}`;
                if (project.thumbnail && typeof project.thumbnail === 'string' && project.thumbnail.trim() && project.thumbnail.length > 0) {
                    // Verify the base64 string is complete
                    const trimmed = project.thumbnail.trim();
                    if (trimmed.startsWith('data:image')) {
                        // Check if base64 data is present and not truncated
                        const base64Part = trimmed.split(',')[1];
                        if (base64Part && base64Part.length > 100) {
                            thumbnailSrc = trimmed;
                            console.log(`Project ${index + 1} (${project.name}): Using thumbnail, total length: ${trimmed.length}, base64 length: ${base64Part.length}`);
                        } else {
                            console.warn(`Project ${index + 1} (${project.name}): Base64 data appears truncated (length: ${base64Part ? base64Part.length : 0}), using placeholder`);
                        }
                    } else {
                        // Not a data URL, use as-is (might be external URL)
                        thumbnailSrc = trimmed;
                        console.log(`Project ${index + 1} (${project.name}): Using external thumbnail URL`);
                    }
                } else {
                    console.log(`Project ${index + 1} (${project.name}): Using placeholder image`);
                }
                
                // Create card element
                const card = document.createElement('div');
                card.className = 'project-card card fade-on-scroll';
                card.style.cursor = 'pointer';
                card.onclick = () => {
                    window.location.href = `project-detail.html?id=${project.id}`;
                };
                
                // Create image element
                const img = document.createElement('img');
                img.alt = project.name || 'Project';
                img.className = 'project-card-image';
                img.style.cssText = 'display: block !important; width: 100%; height: 200px; min-height: 200px; object-fit: cover; background-color: var(--bg-secondary); visibility: visible !important; opacity: 1 !important;';
                img.loading = 'lazy';
                
                // Set image source directly
                img.src = thumbnailSrc;
                
                // Log and validate
                if (thumbnailSrc.startsWith('data:image')) {
                    const base64Match = thumbnailSrc.match(/^data:image\/(\w+);base64,(.+)$/);
                    if (base64Match && base64Match[2]) {
                        console.log(`Project ${index + 1} (${project.name}): Setting base64 image, data length: ${base64Match[2].length}`);
                    }
                }
                
                img.onload = function() {
                    console.log(`‚úì Project ${index + 1} (${project.name}): Image loaded successfully`);
                };
                
                img.onerror = function(e) {
                    console.error('‚úó Image load error for project:', project.name);
                    console.error('Error event:', e);
                    console.error('Attempted src type:', thumbnailSrc.startsWith('data:') ? 'base64' : 'URL');
                    console.error('Src length:', thumbnailSrc.length);
                    if (thumbnailSrc.startsWith('data:image')) {
                        const base64Match = thumbnailSrc.match(/^data:image\/(\w+);base64,(.+)$/);
                        if (base64Match) {
                            console.error('Base64 data length:', base64Match[2].length);
                            console.error('Image type:', base64Match[1]);
                            // Check if base64 is valid format
                            const base64Data = base64Match[2];
                            const isValidBase64 = /^[A-Za-z0-9+/]*={0,2}$/.test(base64Data);
                            console.error('Valid base64 format:', isValidBase64);
                            if (!isValidBase64) {
                                console.error('Base64 data contains invalid characters!');
                            }
                        }
                    }
                    // Fallback to placeholder
                    this.onerror = null; // Prevent infinite loop
                    this.src = 'https://via.placeholder.com/400x200?text=Project';
                };
                
                card.appendChild(img);
                
                // Create category badge
                const category = document.createElement('div');
                category.className = 'project-card-category';
                category.textContent = project.category || 'Uncategorized';
                card.appendChild(category);
                
                // Create title
                const title = document.createElement('h3');
                title.className = 'project-card-title';
                title.textContent = project.name || 'Untitled Project';
                card.appendChild(title);
                
                // Create developer name if available
                if (project.developerName) {
                    const developer = document.createElement('p');
                    developer.style.cssText = 'color: var(--text-light); margin: 0.25rem 0; font-size: 0.85rem; font-style: italic;';
                    developer.textContent = `by ${project.developerName}`;
                    card.appendChild(developer);
                }
                
                // Create description
                const description = document.createElement('p');
                description.style.cssText = 'color: var(--text-secondary); margin: 0.5rem 0; font-size: 0.9rem;';
                description.textContent = project.description 
                    ? (project.description.length > 100 ? project.description.substring(0, 100) + '...' : project.description)
                    : 'No description';
                card.appendChild(description);
                
                // Create tags container
                if (project.tags && project.tags.length > 0) {
                    const tagsContainer = document.createElement('div');
                    tagsContainer.style.cssText = 'display: flex; flex-wrap: wrap; gap: 0.25rem; margin: 0.5rem 0;';
                    project.tags.slice(0, 3).forEach(tag => {
                        const tagSpan = document.createElement('span');
                        tagSpan.style.cssText = 'padding: 0.2rem 0.5rem; background: rgba(102, 126, 234, 0.1); color: var(--primary-gradient-start); border-radius: var(--radius-sm); font-size: 0.75rem; border: 1px solid rgba(102, 126, 234, 0.2);';
                        tagSpan.textContent = tag;
                        tagsContainer.appendChild(tagSpan);
                    });
                    if (project.tags.length > 3) {
                        const moreTag = document.createElement('span');
                        moreTag.style.cssText = 'padding: 0.2rem 0.5rem; background: rgba(102, 126, 234, 0.1); color: var(--primary-gradient-start); border-radius: var(--radius-sm); font-size: 0.75rem; border: 1px solid rgba(102, 126, 234, 0.2);';
                        moreTag.textContent = `+${project.tags.length - 3}`;
                        tagsContainer.appendChild(moreTag);
                    }
                    card.appendChild(tagsContainer);
                }
                
                // Create footer with date and status
                const footer = document.createElement('div');
                footer.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;';
                
                const date = document.createElement('span');
                date.className = 'project-card-date';
                date.textContent = project.createdAt ? new Date(project.createdAt).toLocaleDateString() : 'No date';
                footer.appendChild(date);
                
                const status = document.createElement('span');
                const statusColor = ProjectDock.Utils ? ProjectDock.Utils.getStatusColor(project.status) : (project.status === 'Completed' ? '#48bb78' : project.status === 'In Progress' ? '#4299e1' : '#ed8936');
                status.style.cssText = `padding: 0.25rem 0.75rem; background: ${statusColor}; color: white; border-radius: var(--radius-sm); font-size: 0.85rem;`;
                status.textContent = project.status || 'Planned';
                footer.appendChild(status);
                
                card.appendChild(footer);
                
                // Append to grid
                grid.appendChild(card);
            });

            // Re-initialize scroll animations after a short delay to ensure DOM is ready
            setTimeout(() => {
                if (ProjectDock && ProjectDock.ScrollAnimations) {
                    ProjectDock.ScrollAnimations.init();
                }
            }, 100);
        }

        // Update project count
        function updateProjectCount() {
            document.getElementById('project-count').textContent = filteredProjects.length;
        }

        // Search functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const searchTerm = e.target.value;
            filterProjects();
        });

        // Category filter
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterProjects();
            });
        });

        // Sort functionality
        document.getElementById('sort-select').addEventListener('change', (e) => {
            filteredProjects = ProjectDock.SearchFilter.sortProjects(filteredProjects, e.target.value);
            renderProjects();
        });

        // Filter projects
        function filterProjects() {
            const searchTerm = document.getElementById('search-input').value;
            const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
            
            filteredProjects = ProjectDock.SearchFilter.filterProjects(
                allProjects, 
                searchTerm, 
                activeCategory === 'all' ? null : activeCategory,
                selectedTags
            );
            
            const sortBy = document.getElementById('sort-select').value;
            filteredProjects = ProjectDock.SearchFilter.sortProjects(filteredProjects, sortBy);
            
            renderProjects();
            updateProjectCount();
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Check if ProjectDock is loaded
            if (typeof ProjectDock === 'undefined' || !ProjectDock.ProjectStorage) {
                console.error('ProjectDock is not loaded. Check if js/app.js is loaded correctly.');
                return;
            }
            
            loadProjects();
            
            // Check for category filter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const categoryFilter = urlParams.get('category');
            if (categoryFilter) {
                // Find and activate the matching filter button
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    if (btn.dataset.category === categoryFilter) {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        filterProjects();
                    }
                });
            }
        });
    </script>
</body>
</html>

